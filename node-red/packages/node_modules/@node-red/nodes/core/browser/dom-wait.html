<script type="text/javascript">
  RED.nodes.registerType('dom-wait', {
    category: 'browser',
    color: '#a6bbcf',
    defaults: {
      browserName: {value: "", required: true},
      selector: {value: "", required: true},
      selectorType: {value: "xpath"},
      selectorName: {value: "", required: true},
      condition: {value: ""},
      conditionType: {value: "has"},
    },
    inputs: 1,
    outputs: 1,
    icon: "file.png",
    paletteLabel: RED._("node-red:browser.dom-wait"),
    label: function () {
      if (!this.selector) {
        return this._("browser.dom-wait");
      }
      let label = ""
      switch (this.conditionType) {
        case "has": {
          label = this._("browser.wait.has");
          break
        }
        case "not": {
          label = this._("browser.wait.not");
          break
        }
        case "startWith": {
          label = this._("browser.wait.startWith");
          break
        }
        case "endWith": {
          label = this._("browser.wait.endWith");
          break
        }
      }
      return label + (this.selectorName ? "->" + this._("browser.operator.target") + ":" + this.selectorName : "")
    },
    oneditprepare: function () {
      initBrowserDialog(this)
      initContentType(this)
    },
    oneditsave: function () {
      closeBrowserDialog(this)
    },
    oneditcancel: function () {
      closeBrowserDialog(this)
    }
  });

  function initContentType(_this) {
    // 初始化选择器类型
    const eq = {
      value: "eq",
      label: _this._("browser.wait.eq"),
      icon: ""
    };
    const ne = {
      value: "ne",
      label: _this._("browser.wait.ne"),
      icon: ""
    };
    const has = {
      value: "has",
      label: _this._("browser.wait.has"),
      icon: ""
    };
    const not = {
      value: "not",
      label: _this._("browser.wait.not"),
      icon: ""
    };
    const startWith = {
      value: "startWith",
      label: _this._("browser.wait.startWith"),
      icon: ""
    };
    const endWith = {
      value: "endWith",
      label: _this._("browser.wait.endWith"),
      icon: ""
    };
    $("#node-input-condition").typedInput({
      default: "has",
      typeField: $("#node-input-conditionType"),
      types: [eq, ne, has, not, startWith, endWith],
      selectList: [
        {
          'label': _this._("browser.wait.eq"),
          'value': 'eq'
        },
        {
          'label': _this._("browser.wait.ne"),
          'value': 'ne'
        },
        {
          'label': _this._("browser.wait.has"),
          'value': 'has'
        },
        {
          'label': _this._("browser.wait.not"),
          'value': 'not'
        },
        {
          'label': _this._("browser.wait.startWith"),
          'value': 'startWith'
        },
        {
          'label': _this._("browser.wait.endWith"),
          'value': 'endWith'
        }
      ],
    });
  }
</script>
<script type="text/html" data-template-name="dom-wait">
  <div class="form-row">
    <label for="node-input-browserName"><i class="fa fa-tag"></i><span data-i18n="browser.label.browserName"></span></label>
    <select id="node-input-browserName">
    </select>
  </div>
  <!-- 元素库 -->
  <div class="form-row">
    <label for="node-input-domLibrary"><i class="fa fa-tag"></i><span
            data-i18n="browser.label.domLibrary"></span></label>
    <select style="width:150px" id="node-input-domLibrary">
    </select>
    <button id="node-input-catchBtn" type="button" class="red-ui-button" data-i18n="browser.label.findDom"></button>
  </div>
  <div class="form-row">
    <label htmlFor="node-input-selector"><i class="fa fa-tag"></i><span
            data-i18n="browser.label.selector"></span></label>
    <input type="text" id="node-input-selector">
    <input type="hidden" id="node-input-selectorType">
  </div>
  <div class="form-row">
    <label htmlFor="node-input-selectorName"><i class="fa fa-tag"></i><span
            data-i18n="browser.label.selector-name"></span></label>
    <input type="text" id="node-input-selectorName">
  </div>
  <div class="form-row">
    <label htmlFor="node-input-condition"><i class="fa fa-tag"></i><span data-i18n="browser.label.condition"></span></label>
    <input type="text" id="node-input-condition">
    <input type="hidden" id="node-input-conditionType">
  </div>
</script>
